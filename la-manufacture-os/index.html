<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#0A84FF" />
    <meta name="description" content="FLOW - Master your time" />
    <title>FLOW</title>
    <link rel="icon" type="image/svg+xml" href="/src/assets/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json" />
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png" />
    <meta name="apple-mobile-web-app-title" content="FLOW" />
    <meta name="application-name" content="FLOW" />
    <meta name="msapplication-TileColor" content="#141413" />
    <meta name="msapplication-config" content="/browserconfig.xml" />

    <!-- CSS imports -->
    <link rel="stylesheet" href="/src/css/flow-cutx-bridge.css" />
    <link rel="stylesheet" href="/src/css/design-system.css" />
    <link rel="stylesheet" href="/src/css/variables.css" />
    <link rel="stylesheet" href="/src/css/reset.css" />
    <link rel="stylesheet" href="/src/css/components.css" />
    <link rel="stylesheet" href="/src/css/commandbar.css" />
    <link rel="stylesheet" href="/src/css/morning.css" />
    <link rel="stylesheet" href="/src/css/planning.css" />
    <link rel="stylesheet" href="/src/css/app.css" />
    <link rel="stylesheet" href="/src/css/quick-dump.css" />
    <link rel="stylesheet" href="/src/css/universal-input.css" />
    <link rel="stylesheet" href="/src/css/mobile.css" />
    <link rel="stylesheet" href="/src/css/notes.css" />
    <link rel="stylesheet" href="/src/css/team.css" />

    <!-- CRITICAL: Show auth form INSTANTLY on non-localhost (before any JS loads) -->
    <style id="instant-auth-style">
      /* On production (non-localhost), hide loader and show auth immediately */
      .instant-auth-mode #appLoader {
        display: none !important;
        opacity: 0 !important;
      }
      .instant-auth-mode #view-day {
        display: none !important;
        opacity: 0 !important;
      }
      .instant-auth-mode #view-auth {
        display: block !important;
        opacity: 1 !important;
      }
      .instant-auth-mode nav {
        display: none !important;
      }
      .instant-auth-mode .container {
        opacity: 1 !important;
        pointer-events: auto !important;
      }
    </style>
  </head>

  <body>
    <script>
      // INSTANT AUTH: Show login form immediately on production (no waiting for JS modules)
      (function () {
        var isLocalhost =
          window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        if (!isLocalhost) {
          document.body.classList.add('instant-auth-mode');
          // Skip briefing check - user needs to login first
          return;
        }

        // Only check briefing on localhost (local dev mode)
        try {
          var today = new Date().toISOString().slice(0, 10);
          var lastBriefing = localStorage.getItem('last_briefing');
          if (lastBriefing !== today) {
            document.body.classList.add('briefing-active');
          }
        } catch (e) {
          // localStorage indisponible (nav privee iOS) - skip briefing
        }
      })();
    </script>

    <!-- Loading screen -->
    <div id="appLoader" class="app-loader">
      <div class="loader-content">
        <div class="loader-logo"><span>F</span><span>L</span><span>O</span><span>W</span></div>
        <div class="loader-spinner"></div>
        <div class="loader-text">Connexion...</div>
      </div>
    </div>

    <div class="container" id="app">
      <header>
        <div class="brand">
          <div class="header-logo">
            <span class="header-logo-letter">F</span>
            <span class="header-logo-letter">L</span>
            <span class="header-logo-letter">O</span>
            <span class="header-logo-letter">W</span>
          </div>
        </div>
        <div class="topStatus">
          <span class="badge">SECOND BRAIN</span>
          <span class="badge" id="storageBadge">Storage...</span>
          <span class="badge hidden" id="googleBadge">G</span>
          <span class="badge" id="progressBadge">—</span>
          <!-- Notification Bell -->
          <div class="notification-container" id="notificationContainer">
            <button class="notification-bell" id="notificationBell">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                <path d="M13.73 21a2 2 0 0 1-3.46 0" />
              </svg>
              <span class="notification-badge hidden" id="notificationBadge">0</span>
            </button>
            <div class="notification-dropdown hidden" id="notificationDropdown">
              <div class="notification-header">
                <span>Notifications</span>
                <button id="markAllReadBtn">Tout lire</button>
              </div>
              <div class="notification-list" id="notificationList">
                <div class="notification-empty">Aucune notification</div>
              </div>
            </div>
          </div>
          <!-- Settings Button -->
          <button class="settings-btn" id="nav-config" title="Paramètres">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="3" />
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
              />
            </svg>
          </button>
        </div>
        <div id="storageWarn"></div>
      </header>

      <!-- Vue: AUTH - Custom UI with Clerk backend -->
      <div class="view" id="view-auth">
        <div class="auth-fullscreen">
          <div class="auth-bg"></div>
          <div class="auth-content">
            <div class="auth-logo">
              <span class="logo-letter">F</span>
              <span class="logo-letter">L</span>
              <span class="logo-letter">O</span>
              <span class="logo-letter">W</span>
            </div>
            <p class="auth-tagline">MASTER YOUR TIME</p>

            <div class="auth-forms-wrapper">
              <!-- Connexion -->
              <div class="auth-form-minimal" id="loginForm">
                <input
                  type="email"
                  id="loginEmail"
                  placeholder="Email"
                  autocomplete="email"
                  class="input-minimal"
                />
                <div class="password-wrapper-minimal">
                  <input
                    type="password"
                    id="loginPassword"
                    placeholder="Password"
                    autocomplete="current-password"
                    class="input-minimal"
                  />
                  <button type="button" class="password-toggle-minimal" data-target="loginPassword">
                    <svg
                      class="eye-icon eye-open"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                    <svg
                      class="eye-icon eye-closed hidden"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path
                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                      />
                      <line x1="1" y1="1" x2="23" y2="23" />
                    </svg>
                  </button>
                </div>
                <button class="btn-minimal" id="loginBtn">Sign In</button>

                <!-- Séparateur -->
                <div class="auth-divider">
                  <span>or</span>
                </div>

                <!-- Bouton Google -->
                <button class="btn-google" id="googleSignInBtn" type="button">
                  <svg class="google-icon" viewBox="0 0 24 24" width="20" height="20">
                    <path
                      fill="#4285F4"
                      d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                    />
                    <path
                      fill="#34A853"
                      d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                    />
                    <path
                      fill="#FBBC05"
                      d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                    />
                    <path
                      fill="#EA4335"
                      d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                    />
                  </svg>
                  Continue with Google
                </button>

                <p class="auth-switch-minimal">
                  No account? <a href="#" id="showRegister">Create one</a>
                </p>
                <p class="auth-forgot-minimal">
                  <a href="#" id="showForgotPassword">Forgot password?</a>
                </p>
                <div class="auth-error" id="loginError"></div>
              </div>

              <!-- Inscription -->
              <div class="auth-form-minimal hidden" id="registerForm">
                <input
                  type="text"
                  id="registerName"
                  placeholder="Name"
                  autocomplete="name"
                  class="input-minimal"
                />
                <input
                  type="email"
                  id="registerEmail"
                  placeholder="Email"
                  autocomplete="email"
                  class="input-minimal"
                />
                <div class="password-wrapper-minimal">
                  <input
                    type="password"
                    id="registerPassword"
                    placeholder="Password"
                    autocomplete="new-password"
                    class="input-minimal"
                  />
                  <button
                    type="button"
                    class="password-toggle-minimal"
                    data-target="registerPassword"
                  >
                    <svg
                      class="eye-icon eye-open"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                    <svg
                      class="eye-icon eye-closed hidden"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path
                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                      />
                      <line x1="1" y1="1" x2="23" y2="23" />
                    </svg>
                  </button>
                </div>
                <button class="btn-minimal" id="registerBtn">Create Account</button>
                <p class="auth-switch-minimal">
                  Already have an account? <a href="#" id="showLogin">Sign in</a>
                </p>
                <div class="auth-error" id="registerError"></div>
              </div>

              <!-- Verification Code -->
              <div class="auth-form-minimal hidden" id="verifyForm">
                <p class="verify-message">Enter the verification code sent to your email</p>
                <input
                  type="text"
                  id="verifyCode"
                  placeholder="Verification code"
                  autocomplete="one-time-code"
                  class="input-minimal"
                  maxlength="6"
                />
                <button class="btn-minimal" id="verifyBtn">Verify</button>
                <p class="auth-switch-minimal"><a href="#" id="backToRegister">Back</a></p>
                <div class="auth-error" id="verifyError"></div>
              </div>

              <!-- Forgot Password -->
              <div class="auth-form-minimal hidden" id="forgotPasswordForm">
                <p class="verify-message">Enter your email to reset your password</p>
                <input
                  type="email"
                  id="forgotEmail"
                  placeholder="Email"
                  autocomplete="email"
                  class="input-minimal"
                />
                <button class="btn-minimal" id="forgotBtn">Send Reset Code</button>
                <p class="auth-switch-minimal"><a href="#" id="backToLogin">Back to login</a></p>
                <div class="auth-error" id="forgotError"></div>
              </div>

              <!-- Reset Password -->
              <div class="auth-form-minimal hidden" id="resetPasswordForm">
                <p class="verify-message">Enter the code and your new password</p>
                <input
                  type="text"
                  id="resetCode"
                  placeholder="Reset code"
                  autocomplete="one-time-code"
                  class="input-minimal"
                  maxlength="6"
                />
                <div class="password-wrapper-minimal">
                  <input
                    type="password"
                    id="newPassword"
                    placeholder="New password"
                    autocomplete="new-password"
                    class="input-minimal"
                  />
                  <button type="button" class="password-toggle-minimal" data-target="newPassword">
                    <svg
                      class="eye-icon eye-open"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                      <circle cx="12" cy="12" r="3" />
                    </svg>
                    <svg
                      class="eye-icon eye-closed hidden"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.5"
                    >
                      <path
                        d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                      />
                      <line x1="1" y1="1" x2="23" y2="23" />
                    </svg>
                  </button>
                </div>
                <button class="btn-minimal" id="resetBtn">Reset Password</button>
                <div class="auth-error" id="resetError"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Vue: JOUR -->
      <div class="view active" id="view-day">
        <div class="view-header">
          <div class="date-sub" id="dayLabel">—</div>
          <h1 id="dayNum">—</h1>
        </div>
        <div id="lateBox"></div>

        <!-- Barre d'édition (hidden par défaut) -->
        <div class="edit-bar" id="editBar">
          <span id="selectedCount">0 sélectionnée(s)</span>
          <button class="edit-bar-btn" id="selectAllBtn">Tout</button>
          <button class="edit-bar-btn danger" id="deleteSelectedBtn">
            <svg
              class="edit-bar-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="3 6 5 6 21 6" />
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
              />
            </svg>
            Supprimer
          </button>
          <button class="edit-bar-btn" id="cancelEditBtn">Annuler</button>
        </div>

        <div class="list" id="dayList"></div>

        <div class="day-actions">
          <button class="btn btn-secondary btn-small" id="editModeBtn">Éditer</button>
        </div>

        <!-- Floating Add Button -->
        <button class="fab-add-task" id="manualAddBtn" title="Nouvelle tâche">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 20h9M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
          </svg>
        </button>
      </div>

      <!-- Vue: PLANNING -->
      <div class="view" id="view-week">
        <div class="planning-container">
          <div class="planning-header">
            <button class="month-nav" id="prevMonth">‹</button>
            <h2 class="month-title" id="monthTitle">Janvier 2026</h2>
            <button class="month-nav" id="nextMonth">›</button>
          </div>

          <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be generated here -->
          </div>

          <div class="day-detail" id="dayDetail">
            <div class="day-detail-header">
              <h3 id="selectedDayTitle">Sélectionne un jour</h3>
              <div class="day-detail-actions">
                <button class="btn-link hidden" id="editDayDetailBtn">Éditer</button>
                <button class="btn-link hidden" id="addTaskToDay">+ Ajouter</button>
              </div>
            </div>
            <!-- Barre d'édition day detail -->
            <div class="edit-bar edit-bar-detail" id="editBarDetail">
              <span id="selectedCountDetail">0 sélectionnée(s)</span>
              <button class="edit-bar-btn" id="selectAllDetailBtn">Tout</button>
              <button class="edit-bar-btn danger" id="deleteSelectedDetailBtn">
                <svg
                  class="edit-bar-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <polyline points="3 6 5 6 21 6" />
                  <path
                    d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                  />
                </svg>
                Supprimer
              </button>
              <button class="edit-bar-btn" id="cancelEditDetailBtn">Annuler</button>
            </div>
            <div class="day-tasks-list" id="dayTasksList"></div>
          </div>
        </div>
      </div>

      <!-- Vue: CONFIG -->
      <div class="view" id="view-config">
        <div class="view-header">
          <h2 class="settings-title">SETTINGS</h2>
        </div>

        <div class="settings-section">
          <label class="settings-label">
            <svg
              class="label-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="3 6 5 6 21 6" />
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
              />
              <line x1="10" y1="11" x2="10" y2="17" />
              <line x1="14" y1="11" x2="14" y2="17" />
            </svg>
            Zone de danger
          </label>
          <div class="btn-group">
            <button class="btn btn-danger" id="wipeBtn">
              <span>Vider les données</span>
            </button>
            <button class="btn btn-secondary" id="resetUiBtn">
              <span>Reset UI</span>
            </button>
          </div>
        </div>

        <!-- Google Calendar Integration -->
        <div class="settings-section hidden" id="googleCalendarSection">
          <label class="settings-label">
            <svg
              class="label-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
              <line x1="16" y1="2" x2="16" y2="6" />
              <line x1="8" y1="2" x2="8" y2="6" />
              <line x1="3" y1="10" x2="21" y2="10" />
            </svg>
            Google Calendar
          </label>
          <div id="googleStatus">
            <!-- Genere dynamiquement -->
          </div>
        </div>

        <div class="settings-section" id="logoutSection">
          <label class="settings-label">
            <svg
              class="label-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            Compte
          </label>
          <button class="btn btn-secondary btn-full" id="logoutBtn">
            <svg
              class="btn-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
              <polyline points="16 17 21 12 16 7" />
              <line x1="21" y1="12" x2="9" y2="12" />
            </svg>
            <span>Se déconnecter</span>
          </button>
        </div>
      </div>

      <!-- Vue: NOTES (SPA) -->
      <div class="view" id="view-notes">
        <div class="view-header">
          <h2 class="settings-title">IDÉES</h2>
        </div>

        <!-- Toolbar: Search + Filters -->
        <div class="notes-toolbar">
          <div class="search-bar">
            <svg
              class="search-icon"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <input
              type="text"
              class="search-input"
              id="notesSearchInput"
              placeholder="Rechercher dans vos notes..."
            />
          </div>

          <div class="filters">
            <button class="filter-chip active" data-filter="all">Toutes</button>
            <button class="filter-chip" data-filter="pinned">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 17v5m-7-3l7-7 7 7" />
              </svg>
              Épinglées
            </button>
            <select class="filter-select" id="notesProjectFilter">
              <option value="">Tous les projets</option>
            </select>
            <button class="btn btn-primary" id="createNoteBtn">+ Nouvelle idée</button>
          </div>
        </div>

        <!-- Notes Container (Google Keep style) -->
        <div class="notes-container" id="notesContainer"></div>

        <!-- Empty State -->
        <div class="empty-state hidden" id="notesEmptyState">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path
              d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
            />
          </svg>
          <h3>Aucune idée</h3>
          <p>Créez votre première idée pour commencer</p>
          <button class="btn btn-primary" id="emptyCreateNoteBtn">+ Créer une idée</button>
        </div>
      </div>

      <!-- Vue: TEAM (SPA) -->
      <div class="view" id="view-team">
        <div class="view-header">
          <h2 class="settings-title">ÉQUIPE</h2>
        </div>

        <!-- Tabs Navigation -->
        <div class="tabs-wrapper">
          <div class="tabs">
            <button class="tab active" data-tab="membres">Membres</button>
            <button class="tab" data-tab="invitations">Invitations</button>
            <button class="tab" data-tab="projets">Projets</button>
            <button class="tab" data-tab="documents">Documents</button>
          </div>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
          <!-- Membres Tab -->
          <div class="tab-pane active" id="team-membres">
            <div class="settings-section">
              <div class="settings-section-header">
                <label class="settings-label">
                  <svg
                    class="label-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                  </svg>
                  Membres de l'équipe
                </label>
                <p class="help-text">Pour ajouter un membre, utilisez l'onglet "Invitations"</p>
              </div>
              <div class="team-grid" id="teamMembersGrid"></div>
            </div>
          </div>

          <!-- Invitations Tab -->
          <div class="tab-pane" id="team-invitations">
            <div class="settings-section">
              <div class="settings-section-header">
                <label class="settings-label">
                  <svg
                    class="label-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
                    ></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                  </svg>
                  Invitations envoyées
                </label>
                <button class="btn btn-primary" id="inviteMemberBtn">+ Inviter</button>
              </div>
              <div class="invitations-list" id="teamInvitationsList"></div>
            </div>
          </div>

          <!-- Projets Tab -->
          <div class="tab-pane" id="team-projets">
            <div class="settings-section">
              <div class="settings-section-header">
                <label class="settings-label">
                  <svg
                    class="label-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"
                    />
                  </svg>
                  Projets
                </label>
                <button class="btn btn-primary" id="addProjectBtn">+ Créer</button>
              </div>
              <div class="team-grid" id="teamProjectsGrid"></div>
            </div>
          </div>

          <!-- Documents Tab -->
          <div class="tab-pane" id="team-documents">
            <div class="settings-section">
              <div class="settings-section-header">
                <label class="settings-label">
                  <svg
                    class="label-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z" />
                    <polyline points="13 2 13 9 20 9" />
                  </svg>
                  Documents partagés
                </label>
                <button class="btn btn-primary" id="uploadDocBtn">+ Upload</button>
              </div>
              <div class="files-list" id="teamFilesList"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Navigation Dock - Minimal SpaceX style -->
    <nav>
      <button class="active" id="nav-day">
        <svg
          class="nav-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <circle cx="12" cy="12" r="4" />
          <path
            d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M4.93 19.07l1.41-1.41M17.66 6.34l1.41-1.41"
          />
        </svg>
        <span class="nav-label">Today</span>
      </button>
      <button id="nav-week">
        <svg
          class="nav-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <rect x="3" y="4" width="18" height="18" rx="2" />
          <path d="M3 10h18M8 2v4M16 2v4" />
        </svg>
        <span class="nav-label">Plan</span>
      </button>
      <button id="nav-inbox">
        <svg
          class="nav-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path d="M12 5v14M5 12h14" />
        </svg>
        <span class="nav-label">Add</span>
      </button>
      <button id="nav-notes">
        <svg
          class="nav-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
          />
        </svg>
        <span class="nav-label">Notes</span>
      </button>
      <button id="nav-team">
        <svg
          class="nav-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
          <circle cx="9" cy="7" r="4" />
          <path d="M22 21v-2a4 4 0 0 0-3-3.87" />
          <path d="M16 3.13a4 4 0 0 1 0 7.75" />
        </svg>
        <span class="nav-label">Team</span>
      </button>
    </nav>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Share Modal -->
    <div class="share-modal hidden" id="shareModal">
      <div class="share-modal-content">
        <div class="share-modal-header">
          <h3>Partager la tache</h3>
          <button class="share-modal-close" id="shareModalClose">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <p class="share-task-title" id="shareTaskTitle"></p>
        <div class="share-search-section">
          <input
            type="text"
            id="shareUserSearch"
            placeholder="Rechercher un utilisateur..."
            class="share-search-input"
          />
          <div class="share-search-results" id="shareSearchResults"></div>
        </div>
        <div class="share-current-section">
          <h4>Partage avec</h4>
          <div class="share-current-list" id="currentShares"></div>
        </div>
      </div>
    </div>

    <!-- Modal: Create/Edit Note -->
    <div class="modal-overlay" id="noteModal">
      <div class="modal modal-large">
        <div class="modal-header">
          <h2 class="modal-title" id="noteModalTitle">Créer une note</h2>
          <button class="modal-close">×</button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="noteId" />
          <div class="input-group">
            <label class="input-label">Titre</label>
            <input
              type="text"
              class="input"
              id="noteTitle"
              placeholder="Titre de la note"
              maxlength="255"
            />
          </div>
          <div class="input-group">
            <label class="input-label">Contenu</label>
            <textarea
              class="input textarea note-content"
              id="noteContent"
              placeholder="Écrivez votre note..."
            ></textarea>
          </div>
          <div class="input-group">
            <label class="input-label">Couleur</label>
            <div class="color-picker">
              <button class="color-btn" data-color="" title="Aucune"></button>
              <button class="color-btn" data-color="blue" title="Technique/Dev"></button>
              <button class="color-btn" data-color="green" title="Idée/Créativité"></button>
              <button class="color-btn" data-color="yellow" title="Attention"></button>
              <button class="color-btn" data-color="orange" title="Urgent"></button>
              <button class="color-btn" data-color="red" title="Critique"></button>
              <button class="color-btn" data-color="purple" title="Stratégie"></button>
            </div>
          </div>
          <div class="input-group">
            <label class="checkbox-label">
              <input type="checkbox" id="notePinned" />
              <span>Épingler cette note</span>
            </label>
          </div>
          <div class="input-group">
            <label class="input-label">Lier à un projet</label>
            <div style="display: flex; gap: 8px">
              <select class="input" id="noteProject" style="flex: 1">
                <option value="">Aucun projet</option>
              </select>
              <button
                type="button"
                class="btn btn-secondary"
                id="quickAddProjectBtn"
                title="Créer un projet"
              >
                +
              </button>
            </div>
          </div>
          <div class="input-group">
            <label class="input-label">Lier à une tâche</label>
            <select class="input" id="noteTask">
              <option value="">Aucune tâche</option>
            </select>
          </div>
          <div class="input-group">
            <label class="input-label">Partager avec</label>
            <div class="shares-list" id="sharesList"></div>
            <button class="btn btn-secondary btn-sm" id="shareNoteBtn">+ Partager</button>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary">Annuler</button>
          <button class="btn btn-danger hidden" id="deleteNoteBtn">Supprimer</button>
          <button class="btn btn-primary" id="saveNoteBtn">Enregistrer</button>
        </div>
      </div>
    </div>

    <!-- Modal: Share Note -->
    <div class="modal-overlay" id="shareModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Partager la note</h2>
          <button class="modal-close">×</button>
        </div>
        <div class="modal-body">
          <div class="input-group">
            <label class="input-label">Membre</label>
            <select class="input" id="shareMember">
              <option value="">Sélectionner un membre</option>
            </select>
          </div>
          <div class="input-group">
            <label class="input-label">Permission</label>
            <select class="input" id="sharePermission">
              <option value="view">Lecture seule</option>
              <option value="edit">Édition</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary">Annuler</button>
          <button class="btn btn-primary" id="confirmShareBtn">Partager</button>
        </div>
      </div>
    </div>

    <!-- Modal: Invite Member -->
    <div class="modal-overlay" id="inviteMemberModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">Inviter un membre</h2>
          <button class="modal-close">×</button>
        </div>
        <div class="modal-body">
          <p style="color: #666; margin-bottom: 20px; font-size: 14px">
            Le membre recevra un email avec un lien d'invitation pour créer son compte et accéder à
            ses tâches.
          </p>
          <div class="input-group">
            <label class="input-label">Email du membre *</label>
            <input
              type="email"
              class="input"
              id="inviteEmail"
              placeholder="membre@example.com"
              required
            />
          </div>
          <div class="input-group">
            <label class="input-label">Nom du membre *</label>
            <input
              type="text"
              class="input"
              id="inviteName"
              placeholder="Ex: Nicolas Dupont"
              required
            />
          </div>
          <div class="input-group">
            <label class="input-label">Couleur d'avatar (optionnel)</label>
            <input type="color" class="input" id="inviteColor" value="#3b82f6" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary">Annuler</button>
          <button class="btn btn-primary" id="sendInviteBtn">Envoyer l'invitation</button>
        </div>
      </div>
    </div>

    <!-- Modal: Add/Edit Project -->
    <div class="modal-overlay" id="projectModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title" id="projectModalTitle">Créer un projet</h2>
          <button class="modal-close">×</button>
        </div>
        <div class="modal-body">
          <input type="hidden" id="projectId" />
          <div class="input-group">
            <label class="input-label">Nom du projet</label>
            <input
              type="text"
              class="input"
              id="projectName"
              placeholder="Ex: Fabrication ligne Nord"
            />
          </div>
          <div class="input-group">
            <label class="input-label">Description</label>
            <textarea
              class="input textarea"
              id="projectDescription"
              placeholder="Décrivez le projet..."
            ></textarea>
          </div>
          <div class="input-group">
            <label class="input-label">Assigné à (plusieurs membres possibles)</label>
            <div class="checkbox-list" id="projectMembersList"></div>
          </div>
          <div class="input-group">
            <label class="input-label">Date limite</label>
            <input type="date" class="input" id="projectDeadline" />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary">Annuler</button>
          <button class="btn btn-primary" id="saveProjectBtn">Créer</button>
        </div>
      </div>
    </div>

    <!-- Main App -->
    <script type="module" src="/src/js/app.js"></script>
  </body>
</html>
